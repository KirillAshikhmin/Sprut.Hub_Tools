# Выключить весь свет
# Глобальный сценарий

## Выключает все лампы, выключатели и розетки в доме.

### Поддерживаемые типы устройств:
- **Лампы** (HS.Lightbulb) - всегда обрабатываются
- **Выключатели** (HS.Switch) - всегда обрабатываются  
- **Розетки** (HS.Outlet) - обрабатываются только при `outlets = true`

### Параметры по умолчанию:
```javascript
var excludeRoomsNames = []; // ID комнат, где не надо выключать свет (например: ["Коридор", "Двор", "Информер"])
var excludeAccessoriesId = []; // ID устройств, которые не надо выключать (например: [130, "188", 200.15, "300.20"])
var hidden = false; // Отключать скрытые устройства
var outlets = false; // Отключать розетки (выключено по умолчанию)
var additionalDevices = []; // ID устройств и сервисов для дополнительного отключения любых типов устройств
var interval = 0; // Интервал выключения устройств в миллисекундах (0 = одновременно, >0 = по очереди)
var debug = false; // Активация дополнительного логгирования для отладки
``` 

### Поддерживаемые форматы исключений устройств:

#### Исключение целых аксессуаров:
- Целые числа: `130`, `188`
- Строки: `"130"`, `"188"`
- Массивы: `[130, 188]`, `["130", "188"]`

#### Исключение конкретных сервисов:
- Дробные числа: `130.13` (аксессуар 130, сервис 13)
- Строки с точкой: `"130.13"` (аксессуар 130, сервис 13)
- Массивы: `[130.13, 188.5]`, `["130.13", "188.5"]`

#### Смешанные форматы:
- `[130, "188", 200.15, "300.20"]` - поддерживает все форматы в одном массиве

### Использование:

#### Основная функция (рекомендуется):
```javascript
global.turnAllOff({
  excludeRooms: ["Коридор", "Двор"],
  excludeAccessories: [130, 188.15],
  additionalDevices: [200, 300.5],
  lightbulbs: true,
  switches: true,
  outlets: false,
  hidden: false,
  interval: 500,
  debug: false
})
```

#### Функция обратной совместимости:
```javascript
global.turnOffLight(excludeRooms, excludeAccessories)
```

#### Примеры использования:

1. **Простое выключение:**
   ```javascript
   global.turnAllOff({})
   ```

2. **Исключение комнат:**
   ```javascript
   global.turnAllOff({
     excludeRooms: ["Коридор", "Двор"]
   })
   ```

3. **Исключение устройств:**
   ```javascript
   global.turnAllOff({
     excludeAccessories: [11, 42, 130.13, 188.5]
   })
   ```

4. **Дополнительные устройства:**
   ```javascript
   global.turnAllOff({
     additionalDevices: [200, 300.5]
   })
   ```

5. **Полная настройка:**
   ```javascript
   global.turnAllOff({
     excludeRooms: ["Коридор"],
     excludeAccessories: [130, 188.15],
     additionalDevices: [200, 300.5],
     lightbulbs: true,
     switches: true,
     outlets: false,
     hidden: false,
     interval: 500,
     debug: true
   })
   ```

6. **Обратная совместимость:**
   ```javascript
   global.turnOffLight(["Коридор"], [130, 188.15])
   ```

### Параметры функции `turnAllOff`:

| Параметр | Тип | По умолчанию | Описание |
|----------|-----|--------------|----------|
| `excludeRooms` | Array | `[]` | Массив названий комнат для исключения |
| `excludeAccessories` | Array | `[]` | Массив ID аксессуаров/сервисов для исключения |
| `additionalDevices` | Array | `[]` | Дополнительные устройства для отключения |
| `lightbulbs` | Boolean | `true` | Отключать лампочки |
| `switches` | Boolean | `true` | Отключать выключатели |
| `outlets` | Boolean | `false` | Отключать розетки |
| `hidden` | Boolean | `false` | Отключать скрытые устройства |
| `interval` | Number | `0` | Интервал выключения в миллисекундах |
| `debug` | Boolean | `false` | Режим отладки |

### Параметры функции `turnOffLight` (обратная совместимость):

| Параметр | Тип | По умолчанию | Описание |
|----------|-----|--------------|----------|
| `excludeRooms` | Array | `[]` | Массив названий комнат для исключения |
| `excludeAccessories` | Array | `[]` | Массив ID аксессуаров/сервисов для исключения |

### Настройка отключения розеток:

Для включения отключения розеток установите:
```javascript
// Новая функция (рекомендуется)
global.turnAllOff({
  outlets: true
})

// Или через старую функцию (розетки не отключаются по умолчанию)
global.turnOffLight([], [])
```

**Внимание:** По умолчанию розетки не отключаются (`outlets = false`), так как это может привести к неожиданному отключению важных устройств (холодильник, серверы и т.д.).

### Дополнительные устройства для отключения:

Параметр `additionalDevices` позволяет отключать любые типы устройств по их идентификаторам:

```javascript
var additionalDevices = [130, 188.15, "200.13"]; // Отключить устройства 130, сервис 15 устройства 188, сервис 13 устройства 200
```

#### Поддерживаемые типы сервисов:
- **Switch** (Выключатель)
- **Lightbulb** (Лампочка)  
- **Outlet** (Розетка)
- **FanBasic** (Вентилятор простой)
- **AirPurifier** (Очиститель воздуха)
- **HeaterCooler** (Нагреватель охладитель)
- **HumidifierDehumidifier** (Увлажнитель осушитель)
- **Door** (Дверь)
- **Faucet** (Водопроводный кран)
- **IrrigationSystem** (Система полива)
- **Valve** (Кран)
- **WindowCovering** (Штора)
- **Thermostat** (Термостат)
- **Speaker** (Динамик)
- **Microphone** (Микрофон)
- **TelevisionSpeaker** (Телевизионный динамик)

#### Форматы идентификаторов:
- Целые числа: `130` (весь аксессуар)
- Дробные числа: `130.15` (аксессуар 130, сервис 15)
- Строки: `"130"`, `"130.15"`
- Массивы: `[130, 188.15, "200.13"]`

### Последовательное выключение устройств:

Параметр `interval` позволяет настроить интервал выключения устройств:

```javascript
var interval = 0; // Одновременное выключение (по умолчанию)
var interval = 500; // Выключение с интервалом 500мс между устройствами
var interval = 1000; // Выключение с интервалом 1 секунда между устройствами
```

#### Валидация данных:
- Только положительные числа (0 и больше)
- Максимальное значение: 60000мс (1 минута)
- Шаг изменения: 100мс
- При некорректном значении автоматически устанавливается 0

#### Примеры использования:
- **0мс** - все устройства выключаются одновременно (быстро)
- **500мс** - устройства выключаются по очереди с интервалом полсекунды (эффект "волны")
- **2000мс** - медленное последовательное выключение (эффект "затухания")

### Отладка:
Установите `debug = true` для включения подробного логирования процесса исключений и последовательного выключения.


# Логический сценарий

## Выключает все лампы, выключатели и розетки в доме при включении выключателя или нажатии кнопки.

### Поддерживаемые типы устройств:
- **Лампы** (HS.Lightbulb) - всегда обрабатываются
- **Выключатели** (HS.Switch) - всегда обрабатываются  
- **Розетки** (HS.Outlet) - обрабатываются только при включенной опции

### Триггеры срабатывания:
- **Включение выключателя** (HS.Switch, HC.On = true)
- **Нажатие кнопки** (HS.StatelessProgrammableSwitch, HC.ProgrammableSwitchEvent)

### Настройки сценария:

#### 1. Исключить комнаты
- **Тип:** Строка
- **По умолчанию:** "Виртуальная"
- **Описание:** Названия комнат через запятую, где не надо выключать свет
- **Пример:** "Виртуальная, Серверная, Коридор"

#### 2. Исключить устройства
- **Тип:** Строка
- **По умолчанию:** "130, 188"
- **Описание:** ID устройств и сервисов через запятую
- **Поддерживаемые форматы:**
  - Целые числа: `130`, `188`
  - Строки: `"130"`, `"188"`
  - Дробные числа: `130.13` (аксессуар 130, сервис 13)
  - Строки с точкой: `"130.13"` (аксессуар 130, сервис 13)
- **Пример:** `130, "188", 200.15, "300.20"`

#### 3. Отключать скрытые
- **Тип:** Логическое значение
- **По умолчанию:** false
- **Описание:** Отключать скрытые устройства

#### 4. Отключать розетки
- **Тип:** Логическое значение
- **По умолчанию:** false
- **Описание:** Отключать розетки (по умолчанию выключено)
- **⚠️ Внимание:** По умолчанию розетки не отключаются, так как это может привести к неожиданному отключению важных устройств (холодильник, серверы и т.д.)

#### 5. Отладка
- **Тип:** Логическое значение
- **По умолчанию:** false
- **Описание:** Активация дополнительного логгирования для отладки

#### 6. Целевое устройство
- **Тип:** Выбор из списка
- **По умолчанию:** "Не выбрано"
- **Описание:** Выберите конкретное устройство для отключения (необязательно)
- **Примечание:** Если выбрано, будет отключаться только это устройство вместо всех

### Установка и настройка:

1. **Импорт сценария:**
   - Скопируйте содержимое файла `Выключить весь свет. Логический.json` в интерфейс хаба
   - Или импортируйте файл через интерфейс

2. **Настройка триггеров:**
   - Перейдите в "Настройки" → "Логика"
   - Найдите нужный выключатель или кнопку
   - Включите логический сценарий "Выключить весь свет (Логический)"
   - Настройте опции согласно вашим потребностям

3. **Настройка опций:**
   - **Исключить комнаты:** Укажите комнаты, где свет не должен выключаться
   - **Исключить устройства:** Укажите ID устройств и сервисов для исключения
   - **Отключать скрытые:** Включите, если нужно отключать скрытые устройства
   - **Отключать розетки:** Включите с осторожностью, если нужно отключать розетки
   - **Отладка:** Включите для диагностики работы сценария

### Примеры использования:

#### Пример 1: Простое использование
- Подключите к выключателю в прихожей
- При включении выключателя весь свет в доме выключится
- Исключения: комната "Виртуальная", устройства 130 и 188

#### Пример 2: С настройкой исключений
- **Исключить комнаты:** "Спальня, Детская"
- **Исключить устройства:** "130, 188.15, 200.5"
- **Отключать розетки:** false
- **Отладка:** true

#### Пример 3: Отключение только конкретного устройства
- **Целевое устройство:** "Люстра в гостиной"
- При срабатывании будет отключаться только выбранное устройство

### Переменные сценария:
- `lastTriggerTime` - время последнего срабатывания
- `triggerCount` - количество срабатываний

### Безопасность:
- Розетки по умолчанию не отключаются для предотвращения случайного отключения важных устройств
- Все настройки применяются индивидуально для каждого устройства-триггера
- Подробное логирование доступно через опцию "Отладка"

### Совместимость:
- Sprut.Hub с поддержкой логических сценариев
- JavaScript ES6 (ECMAScript 6)
- Nashorn движок
