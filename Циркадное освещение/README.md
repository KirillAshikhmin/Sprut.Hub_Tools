# Циркадное освещение

Глобальный и логический сценарий для реализации полноценного циркадного освещения для ламп в Sprut.Hub.

## Логический сценарий


Режим активируется для каждой конкретной лампы и всегда работает когда она включена, обновляя значения яркости и цветовой температуры, если лампа поддерживает или оттенка с насыщенностью раз в 5 минут.

### Параметры:
#### Не менять параметр автоматически после его ручного изменения.
Если включено, то при ручном (или внешнем) изменении любого параметра (яркость, температура, оттенок, насыщенность) это сохранение запомнится и не будет устанавливаться циркадное значение. Сбрасывается при выключении лампы.

#### Останавливать циркадный режим после изменения любого параметра.
Если включено, то при изменении любого параметра лампочки циркадный режим отключается до следующего включения лампы. Если включить лампу изменением яркости, то циркадный режим запущен не будет, только установится температура. Для работы этого параметра необходимо включить пункт "Не менять яркость автоматически после ручного изменения."

#### Режим работы - Несколько пресетов с разными параметрами яркости и температуры. 
-  0 - Долго держится большая яркость, температура света утром холоднеет медленее
-  1 - Яркость вечером уменьшается раньше, утром включается холодный свет
-  2 - С постоянной максимальной яркостью. утром включается холодный свет
  
Настройки режимов можно изменить в глобальном сценарии. А так же можно добавить свои режимы.

## Глобальный сценарий
Используется для получения и установки циркадного освещения для ламп. Логический не работает без глобального!
Примеры:
Установить для одной лампочки: global.setCircadianLight(99);
Установить для нескольких лампочек global.setCircadianLight([97,98,99]);
Так же в метод setCircadianLight можно передать 2 параметра:
preset (Integer) - режим работы
dontChangeBright (Boolean) - не менять яркость при её ручном изменении

Получить значение температуры и яркости для текущего часа и минуты:
let tempAndBright = global.getCircadianLight(preset);
preset (Integer) - режим работы
Результат будет в виде массива
tempAndBright[0] - температура
tempAndBright[1] - яркость.
Используется, если необходимо получить только одно значение, например при использовании лампочки в качестве будильника получать температуру, а яркость увеличивать постепенно.


# История изменений:

## 2.0 
- Эмуляция цветовой температуры посредством изменения оттенка и насыщенности, если у лампы нет этого параметра
- Опция "Останавливать циркадный режим после изменения любого параметра."
- Опция "Не менять яркость автоматически после ручного изменения" заменена на "Не менять параметр автоматически"
- Доработано логирование
- Добавлена глобальная функция global.getHueAndSaturationFromMired(temp) - которая возвращает массив [оттенок, насыщенность] для указанной температуры в майредах (как в хабе 50-400)


## 1.0 Первый релиз